<!-- THIS IS ONLY A TEST FILE -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Recipes</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
</head>

<body>
    <h1>Recipes</h1>
    <div id="recipe">
    </div>
    <script>
        var apiKey = "8291ac263908494dbb724a8ba3637f1a";
        var num = 10;

        $.ajax({
            url: "https://api.spoonacular.com/recipes/random?number=" + num + "&apiKey=" + apiKey,
            method: "GET"
        }).then(function (res) {
            console.log(res);
            //current idea is to process the json data after the Get, and then do a post to my db. 
            //make sure to handle undefined and null 
            for (let i = 0; i < res.recipes.length; i++) {
                var title = res.recipes[i].title;
                var servings = res.recipes[i].servings || 0;
                var image = res.recipes[i].image || "";
                var category = res.recipes[i].cuisines.length > 0 ? res.recipes[i].cuisines[0] : "";
                var dishType = res.recipes[i].dishTypes.length > 0 ? res.recipes[i].dishTypes[0] : "";
                var source = res.recipes[i].sourceName || "";
                var instructions = res.recipes[i].instructions;
                var ingredients = {};

                console.log(`${title} ${servings} ${image} ${category} ${dishType} ${source}`);

                for (let j = 0; j < res.recipes[i].extendedIngredients.length; j++) {
                    ingredients["ingredient_" + [j]] = res.recipes[i].extendedIngredients[j].original
                }

                // console.log(ingredients);
                // console.log(instructions);
                //make a new recipe object 
                let newRecipe = {
                    title: title,
                    servings: servings,
                    image: image,
                    category: category,
                    dishType: dishType,
                    source: source,
                    instructions: instructions,
                    ingredients: ingredients
                }

                //send to database with post
                $.post("/db/newrecipe", newRecipe, function (result) {
                    console.log("posted")
                });
            }







        });




    </script>
</body>

</html>